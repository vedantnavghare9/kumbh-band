<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Kumbh Band - Firebase Version</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root {
  --primary: #22c55e;
  --danger: #ef4444;
  --warning: #f59e0b;
  --dark: #0f172a;
  --gray: #64748b;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: var(--dark);
  color: white;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  padding: 20px;
  min-height: 100vh;
}

.container {
  max-width: 400px;
  margin: 0 auto;
}

/* Header */
.header {
  text-align: center;
  margin-bottom: 30px;
  padding: 20px;
}

.logo {
  font-size: 2.5rem;
  font-weight: 900;
  color: var(--primary);
  margin-bottom: 10px;
}

.subtitle {
  color: var(--gray);
  font-size: 0.9rem;
}

/* Main Display */
.main-display {
  background: #1e293b;
  border-radius: 20px;
  padding: 30px;
  margin-bottom: 20px;
  text-align: center;
}

.distance-circle {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  border: 10px solid #475569;
  margin: 0 auto 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.distance-circle.safe {
  border-color: var(--primary);
  box-shadow: 0 0 30px rgba(34, 197, 94, 0.3);
}

.distance-circle.warning {
  border-color: var(--warning);
  box-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
  animation: pulse 2s infinite;
}

.distance-circle.danger {
  border-color: var(--danger);
  box-shadow: 0 0 30px rgba(239, 68, 68, 0.3);
  animation: pulse 1s infinite;
}

.distance-value {
  font-size: 48px;
  font-weight: 800;
}

.distance-unit {
  color: var(--gray);
  font-size: 16px;
  margin-top: 5px;
}

.status {
  margin-top: 15px;
  font-size: 14px;
  color: var(--gray);
}

/* Connection Panel */
.connection-panel {
  background: #1e293b;
  border-radius: 20px;
  padding: 25px;
  margin-bottom: 20px;
}

.kid-section {
  background: #0f172a;
  border-radius: 15px;
  padding: 20px;
  margin-bottom: 25px;
  text-align: center;
}

.kid-label {
  color: var(--gray);
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 10px;
}

.kid-value {
  font-size: 28px;
  font-weight: 800;
  color: var(--primary);
  font-family: monospace;
  letter-spacing: 2px;
}

.input-group {
  margin-bottom: 20px;
}

.input-label {
  display: block;
  color: var(--gray);
  font-size: 14px;
  margin-bottom: 10px;
}

.input-field {
  width: 100%;
  padding: 15px;
  background: #0f172a;
  border: 2px solid #475569;
  border-radius: 12px;
  color: white;
  font-size: 16px;
  text-align: center;
  transition: all 0.3s;
}

.input-field:focus {
  outline: none;
  border-color: var(--primary);
}

/* Buttons */
.buttons {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin-top: 25px;
}

.btn {
  padding: 18px;
  border: none;
  border-radius: 15px;
  font-size: 18px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), #16a34a);
  color: white;
  box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger), #dc2626);
  color: white;
  box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
}

.btn-secondary {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  color: white;
  box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
}

.btn-secondary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
}

/* Safe Range */
.safe-range {
  background: #1e293b;
  border-radius: 20px;
  padding: 25px;
  margin-bottom: 20px;
}

.range-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.range-value {
  font-size: 24px;
  font-weight: 800;
  color: var(--primary);
}

.range-slider {
  width: 100%;
  margin: 20px 0;
}

.range-labels {
  display: flex;
  justify-content: space-between;
  color: var(--gray);
  font-size: 12px;
  margin-top: 10px;
}

/* Testing Panel */
.testing-panel {
  background: #1e293b;
  border-radius: 20px;
  padding: 25px;
  margin-bottom: 20px;
}

.test-title {
  color: var(--gray);
  font-size: 14px;
  margin-bottom: 15px;
  text-align: center;
}

.test-buttons {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-bottom: 20px;
}

.test-btn {
  padding: 15px;
  background: #0f172a;
  border: 2px solid #475569;
  border-radius: 12px;
  color: white;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.test-btn:hover {
  background: #475569;
  transform: translateY(-2px);
}

.test-btn .icon {
  font-size: 24px;
}

.test-btn .label {
  font-size: 12px;
  color: var(--gray);
}

/* Alert */
.alert {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--danger);
  color: white;
  padding: 15px 25px;
  border-radius: 12px;
  font-weight: 700;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  display: none;
  z-index: 1000;
  max-width: 90%;
  text-align: center;
}

/* Animations */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

@keyframes slideDown {
  from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
  to { transform: translateX(-50%) translateY(0); opacity: 1; }
}

.alert {
  animation: slideDown 0.3s ease;
}

/* Firebase Status */
.firebase-status {
  background: #1e293b;
  border-radius: 20px;
  padding: 15px;
  margin-top: 20px;
  text-align: center;
  font-size: 12px;
  color: var(--gray);
}

/* Responsive */
@media (max-width: 500px) {
  .container {
    padding: 10px;
  }
  
  .distance-circle {
    width: 170px;
    height: 170px;
  }
  
  .distance-value {
    font-size: 40px;
  }
}
</style>

<!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, setDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
</script>
</head>

<body>

<div class="alert" id="alertBox">‚ö†Ô∏è Alert</div>

<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="logo">KUMBH BAND</div>
    <div class="subtitle">Firebase Real-time Tracking</div>
  </div>

  <!-- Main Display -->
  <div class="main-display">
    <div class="distance-circle" id="distanceCircle">
      <div class="distance-value" id="distanceValue">--</div>
      <div class="distance-unit">meters</div>
    </div>
    <div class="status" id="statusText">Disconnected</div>
  </div>

  <!-- Connection Panel -->
  <div class="connection-panel">
    <div class="kid-section">
      <div class="kid-label">Your Band ID</div>
      <div class="kid-value" id="myKid">Loading...</div>
    </div>
    
    <div class="input-group">
      <label class="input-label">Enter Friend's Band ID</label>
      <input type="text" class="input-field" id="friendKid" placeholder="K-1234" maxlength="6">
    </div>
    
    <div class="buttons">
      <button class="btn btn-primary" id="connectBtn" onclick="connectWithFirebase()">CONNECT</button>
      <button class="btn btn-secondary" onclick="showInstructions()">HOW TO TEST</button>
    </div>
  </div>

  <!-- Safe Range -->
  <div class="safe-range">
    <div class="range-header">
      <span class="range-label">Safe Distance</span>
      <span class="range-value" id="safeRangeValue">50</span>
    </div>
    <input type="range" min="10" max="100" value="50" class="range-slider" id="safeRangeSlider" 
           oninput="updateSafeRange(this.value)">
    <div class="range-labels">
      <span>10m</span>
      <span>100m</span>
    </div>
  </div>

  <!-- Testing Panel -->
  <div class="testing-panel">
    <div class="test-title">Test Movement Simulation</div>
    <div class="test-buttons">
      <button class="test-btn" onclick="simulateMovement(-5)">
        <span class="icon">‚¨áÔ∏è</span>
        <span class="label">5m Closer</span>
      </button>
      <button class="test-btn" onclick="simulateMovement(5)">
        <span class="icon">‚¨ÜÔ∏è</span>
        <span class="label">5m Away</span>
      </button>
      <button class="test-btn" onclick="simulateMovement(-20)">
        <span class="icon">‚è¨</span>
        <span class="label">20m Closer</span>
      </button>
      <button class="test-btn" onclick="simulateMovement(20)">
        <span class="icon">‚è´</span>
        <span class="label">20m Away</span>
      </button>
    </div>
    <div class="test-title" id="simulationStatus">Simulation: OFF</div>
  </div>

  <div class="firebase-status" id="firebaseStatus">
    Firebase: Connecting...
  </div>
</div>

<script type="module">
// ================= FIREBASE CONFIGURATION =================
const firebaseConfig = {
  apiKey: "AIzaSyDVV1zZZDAnqOkmNXKW0ipJXatUYtjV4W4",
  authDomain: "kumbh-band-dd624.firebaseapp.com",
  projectId: "kumbh-band-dd624",
  storageBucket: "kumbh-band-dd624.appspot.com",
  messagingSenderId: "153944613096",
  appId: "1:153944613096:web:0c5fe544c93803c2c01902"
};

// Initialize Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

console.log("Firebase initialized successfully!");

// ================= KUMBH BAND CLASS =================
class KumbhBandFirebase {
  constructor() {
    this.myKid = '';
    this.friendKid = '';
    this.isConnected = false;
    this.safeRange = 50;
    this.myLocation = null;
    this.friendLocation = null;
    this.simulationOffset = 0;
    this.watchId = null;
    this.unsubscribe = null;
    this.locationInterval = null;
    
    // Firebase references
    this.myDocRef = null;
    this.friendDocRef = null;
    this.pairRef = null;
    
    this.initialize();
  }
  
  async initialize() {
    console.log("Initializing Kumbh Band with Firebase...");
    
    // 1. Generate K-ID
    await this.generateKid();
    
    // 2. Setup UI
    this.setupUI();
    
    // 3. Update Firebase status
    this.updateFirebaseStatus('Connected');
    
    // 4. Listen for connections to me
    this.listenForConnections();
    
    console.log(`Kumbh Band ready! Your ID: ${this.myKid}`);
  }
  
  async generateKid() {
    // Try to get existing K-ID from localStorage
    let savedKid = localStorage.getItem('kumbh_kid_firebase');
    
    if (!savedKid) {
      // Generate new K-ID and check Firebase for uniqueness
      let isUnique = false;
      let attempts = 0;
      
      while (!isUnique && attempts < 10) {
        savedKid = 'K-' + Math.floor(1000 + Math.random() * 9000);
        
        try {
          // Check if this K-ID exists in Firebase
          const bandDoc = doc(db, 'bands', savedKid);
          // We'll assume it's unique for now (in real app, we'd check)
          isUnique = true;
        } catch (error) {
          attempts++;
          console.log(`Checking K-ID ${savedKid}...`);
        }
      }
      
      if (savedKid) {
        localStorage.setItem('kumbh_kid_firebase', savedKid);
      } else {
        // Fallback to timestamp based
        savedKid = 'K-' + Date.now().toString().slice(-4);
        localStorage.setItem('kumbh_kid_firebase', savedKid);
      }
    }
    
    this.myKid = savedKid;
    document.getElementById('myKid').textContent = this.myKid;
    
    // Create/update my document in Firebase
    this.myDocRef = doc(db, 'bands', this.myKid);
    await this.updateMyFirebaseData();
    
    // Load saved friend
    this.friendKid = localStorage.getItem('kumbh_friend_firebase') || '';
    document.getElementById('friendKid').value = this.friendKid;
    
    // Load safe range
    const savedRange = localStorage.getItem('kumbh_range_firebase');
    if (savedRange) {
      this.safeRange = parseInt(savedRange);
      document.getElementById('safeRangeValue').textContent = this.safeRange;
      document.getElementById('safeRangeSlider').value = this.safeRange;
    }
  }
  
  async updateMyFirebaseData() {
    if (!this.myDocRef) return;
    
    const data = {
      kid: this.myKid,
      location: this.myLocation || this.getDefaultLocation(),
      connectedTo: this.friendKid,
      status: this.isConnected ? 'connected' : 'disconnected',
      lastUpdate: new Date().toISOString(),
      safeRange: this.safeRange
    };
    
    try {
      await setDoc(this.myDocRef, data, { merge: true });
      console.log('Updated my data in Firebase');
    } catch (error) {
      console.error('Error updating Firebase:', error);
    }
  }
  
  getDefaultLocation() {
    // Default location near Prayagraj
    return {
      lat: 25.4358 + (Math.random() - 0.5) * 0.01,
      lng: 81.8463 + (Math.random() - 0.5) * 0.01,
      accuracy: 10,
      simulated: true
    };
  }
  
  setupUI() {
    const friendInput = document.getElementById('friendKid');
    
    // Enter key to connect
    friendInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') this.connect();
    });
    
    // Save friend when typing
    friendInput.addEventListener('input', (e) => {
      localStorage.setItem('kumbh_friend_firebase', e.target.value);
    });
    
    // Start location updates
    this.startLocationUpdates();
  }
  
  startLocationUpdates() {
    if (navigator.geolocation) {
      // Get initial location
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          this.myLocation = {
            lat: pos.coords.latitude,
            lng: pos.coords.longitude,
            accuracy: pos.coords.accuracy,
            timestamp: Date.now()
          };
          this.updateMyFirebaseData();
        },
        () => {
          this.myLocation = this.getDefaultLocation();
          this.updateMyFirebaseData();
        }
      );
      
      // Watch for changes
      this.watchId = navigator.geolocation.watchPosition(
        (pos) => {
          this.myLocation = {
            lat: pos.coords.latitude,
            lng: pos.coords.longitude,
            accuracy: pos.coords.accuracy,
            timestamp: Date.now()
          };
          this.updateMyFirebaseData();
          
          if (this.isConnected) {
            this.calculateDistance();
          }
        },
        (error) => {
          console.log('GPS error, using simulation:', error);
          this.myLocation = this.getDefaultLocation();
          this.updateMyFirebaseData();
        },
        {
          enableHighAccuracy: true,
          maximumAge: 10000,
          timeout: 15000
        }
      );
    } else {
      // No GPS, use simulation
      this.myLocation = this.getDefaultLocation();
      this.updateMyFirebaseData();
      
      // Update location periodically
      this.locationInterval = setInterval(() => {
        this.myLocation.lat += (Math.random() - 0.5) * 0.0001;
        this.myLocation.lng += (Math.random() - 0.5) * 0.0001;
        this.myLocation.timestamp = Date.now();
        this.updateMyFirebaseData();
        
        if (this.isConnected) {
          this.calculateDistance();
        }
      }, 5000);
    }
  }
  
  listenForConnections() {
    // Listen for changes to my document
    this.unsubscribe = onSnapshot(this.myDocRef, (doc) => {
      if (doc.exists()) {
        const data = doc.data();
        
        // Check if someone is trying to connect to me
        if (data.connectedTo && data.connectedTo !== this.friendKid) {
          // Someone wants to connect to me
          this.showAlert(`${data.connectedTo} wants to connect with you!`);
        }
      }
    });
  }
  
  async connect() {
    const input = document.getElementById('friendKid');
    this.friendKid = input.value.trim().toUpperCase();
    
    if (!this.friendKid) {
      this.showAlert('Please enter a K-ID');
      return;
    }
    
    if (this.friendKid === this.myKid) {
      this.showAlert('Cannot connect to yourself');
      return;
    }
    
    if (!this.friendKid.match(/^K-\d{4}$/)) {
      this.showAlert('Use format: K-1234');
      return;
    }
    
    // Save friend
    localStorage.setItem('kumbh_friend_firebase', this.friendKid);
    
    // Update my data with connection
    this.isConnected = true;
    await this.updateMyFirebaseData();
    
    // Create a pair ID for easier tracking
    const pairId = [this.myKid, this.friendKid].sort().join('_');
    this.pairRef = doc(db, 'pairs', pairId);
    
    // Update UI
    this.updateUIForConnection();
    
    // Listen for friend's location
    this.listenToFriend();
    
    this.showAlert(`Connecting to ${this.friendKid}...`);
  }
  
  updateUIForConnection() {
    const connectBtn = document.getElementById('connectBtn');
    connectBtn.textContent = 'DISCONNECT';
    connectBtn.className = 'btn btn-danger';
    connectBtn.onclick = () => this.disconnect();
    document.getElementById('statusText').textContent = `Connecting to ${this.friendKid}...`;
  }
  
  async listenToFriend() {
    // Listen to friend's document
    this.friendDocRef = doc(db, 'bands', this.friendKid);
    
    onSnapshot(this.friendDocRef, (doc) => {
      if (!doc.exists()) {
        document.getElementById('statusText').textContent = `${this.friendKid} not found`;
        return;
      }
      
      const friendData = doc.data();
      this.friendLocation = friendData.location;
      
      // Check if friend is also connected to me
      if (friendData.connectedTo === this.myKid) {
        // MUTUAL CONNECTION ESTABLISHED!
        document.getElementById('statusText').textContent = `Connected to ${this.friendKid}`;
        this.calculateDistance();
      } else {
        document.getElementById('statusText').textContent = `Waiting for ${this.friendKid} to connect back...`;
      }
    });
  }
  
  calculateDistance() {
    if (!this.myLocation || !this.friendLocation) {
      document.getElementById('distanceValue').textContent = '--';
      return;
    }
    
    // Calculate actual distance
    let distance = this.haversineDistance(
      this.myLocation.lat,
      this.myLocation.lng,
      this.friendLocation.lat,
      this.friendLocation.lng
    );
    
    // Add simulation offset
    distance = Math.max(1, Math.round(distance + this.simulationOffset));
    
    // Update display
    document.getElementById('distanceValue').textContent = distance;
    
    // Update circle color
    this.updateCircleColor(distance);
    
    // Update pair document with distance
    this.updatePairDistance(distance);
  }
  
  haversineDistance(lat1, lon1, lat2, lon2) {
    const R = 6371000; // Earth's radius in meters
    const œÜ1 = lat1 * Math.PI / 180;
    const œÜ2 = lat2 * Math.PI / 180;
    const ŒîœÜ = (lat2 - lat1) * Math.PI / 180;
    const ŒîŒª = (lon2 - lon1) * Math.PI / 180;
    
    const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) +
              Math.cos(œÜ1) * Math.cos(œÜ2) *
              Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
    
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  }
  
  updateCircleColor(distance) {
    const circle = document.getElementById('distanceCircle');
    circle.className = 'distance-circle';
    
    if (distance <= this.safeRange) {
      circle.classList.add('safe');
      document.getElementById('statusText').textContent = `Connected (${distance}m)`;
    } else if (distance <= this.safeRange * 1.5) {
      circle.classList.add('warning');
      document.getElementById('statusText').textContent = `‚ö†Ô∏è Warning: ${distance}m`;
      this.vibrate();
    } else {
      circle.classList.add('danger');
      document.getElementById('statusText').textContent = `üö® Danger: ${distance}m AWAY!`;
      this.vibrate(true);
    }
  }
  
  async updatePairDistance(distance) {
    if (!this.pairRef) return;
    
    try {
      await setDoc(this.pairRef, {
        user1: this.myKid,
        user2: this.friendKid,
        distance: distance,
        timestamp: new Date().toISOString()
      }, { merge: true });
    } catch (error) {
      console.error('Error updating pair:', error);
    }
  }
  
  async disconnect() {
    this.isConnected = false;
    this.friendKid = '';
    
    // Update UI
    const connectBtn = document.getElementById('connectBtn');
    connectBtn.textContent = 'CONNECT';
    connectBtn.className = 'btn btn-primary';
    connectBtn.onclick = () => this.connect();
    document.getElementById('statusText').textContent = 'Disconnected';
    document.getElementById('distanceValue').textContent = '--';
    document.getElementById('distanceCircle').className = 'distance-circle';
    
    // Clear friend input
    document.getElementById('friendKid').value = '';
    localStorage.removeItem('kumbh_friend_firebase');
    
    // Update Firebase
    await this.updateMyFirebaseData();
    
    // Reset simulation
    this.simulationOffset = 0;
    document.getElementById('simulationStatus').textContent = 'Simulation: OFF';
    
    this.showAlert('Disconnected');
  }
  
  simulateMovement(change) {
    if (!this.isConnected) {
      this.showAlert('Connect first to simulate');
      return;
    }
    
    this.simulationOffset += change;
    document.getElementById('simulationStatus').textContent = 
      `Simulation: ${this.simulationOffset >= 0 ? '+' : ''}${this.simulationOffset}m`;
    
    this.calculateDistance();
    
    if (Math.abs(change) >= 20) {
      const dir = change > 0 ? 'farther' : 'closer';
      this.showAlert(`Simulated moving ${Math.abs(change)}m ${dir}`);
    }
  }
  
  updateSafeRange(value) {
    this.safeRange = parseInt(value);
    document.getElementById('safeRangeValue').textContent = this.safeRange;
    localStorage.setItem('kumbh_range_firebase', this.safeRange.toString());
    
    if (this.isConnected && this.myLocation && this.friendLocation) {
      this.calculateDistance();
    }
  }
  
  vibrate(strong = false) {
    if (navigator.vibrate) {
      navigator.vibrate(strong ? [200,100,200,100,200] : [100,50,100]);
    }
  }
  
  showAlert(message) {
    const alertBox = document.getElementById('alertBox');
    alertBox.textContent = message;
    alertBox.style.display = 'block';
    
    setTimeout(() => {
      alertBox.style.display = 'none';
    }, 3000);
  }
  
  updateFirebaseStatus(status) {
    document.getElementById('firebaseStatus').textContent = `Firebase: ${status}`;
  }
}

// ================= GLOBAL FUNCTIONS =================
let kumbhBand = null;

async function connectWithFirebase() {
  if (kumbhBand) {
    await kumbhBand.connect();
  }
}

function updateSafeRange(value) {
  if (kumbhBand) {
    kumbhBand.updateSafeRange(value);
  }
}

function simulateMovement(change) {
  if (kumbhBand) {
    kumbhBand.simulateMovement(change);
  }
}

function showInstructions() {
  const instructions = `
    HOW TO TEST WITH 2 DEVICES:
    
    1. OPEN THIS LINK IN TWO DIFFERENT BROWSERS
       (Chrome & Firefox, or Chrome & Safari)
    
    2. NOTE THE K-IDs:
       - Device 1: Shows K-1234 (example)
       - Device 2: Shows K-5678 (example)
    
    3. ON DEVICE 1:
       - Enter K-5678 in friend field
       - Click CONNECT
    
    4. ON DEVICE 2:
       - Enter K-1234 in friend field
       - Click CONNECT
    
    5. WAIT FOR CONNECTION:
       - Both will show "Connected"
       - Distance will appear (20-50m initially)
    
    6. TEST MOVEMENT:
       - Click "5m Away" on one device
       - Watch distance increase!
       - Click "5m Closer" to decrease
    
    USING SIMULATION IF GPS NOT AVAILABLE
    
    FIREBASE IS NOW ACTIVE! Real-time updates every 2 seconds.
  `;
  
  alert(instructions);
}

// ================= INITIALIZE =================
document.addEventListener('DOMContentLoaded', async () => {
  try {
    kumbhBand = new KumbhBandFirebase();
    console.log('Kumbh Band with Firebase loaded!');
  } catch (error) {
    console.error('Failed to initialize:', error);
    document.getElementById('firebaseStatus').textContent = 'Firebase: Error - Check Console';
    document.getElementById('firebaseStatus').style.color = '#ef4444';
  }
});
</script>
</body>
</html>
